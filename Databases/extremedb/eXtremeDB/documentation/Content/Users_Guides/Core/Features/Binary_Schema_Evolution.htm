<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="extremedb.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Binary Schema Evolution</title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/KB_Style.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="TopicContent">
            <div class="nocontent">
                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="7" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">ToC path: </span>
                </div>
            </div>
            <h1>Binary Schema Evolution</h1>
            <blockquote>
                <p>“Binary schema evolution” (BSE) is a feature that allows an application to alter the database schema of a stored database image to a new definition contained in the dictionary of the currently running application.</p>
                <p>Supported schema changes include:</p>
                <ul>
                    <li value="1">Adding new classes</li>
                    <li value="2">Dropping classes</li>
                    <li value="3">Adding new fields to a class</li>
                    <li value="4">Dropping fields from a class</li>
                    <li value="5">Changing the type of a field (a loss of precision, e.g. <code>INT2</code> to <code>INT4</code> is allowed but may cause loss of precision; there is no error or warning)</li>
                    <li value="6">Adding/dropping indexes</li>
                    <li value="7">Adding/dropping fields from existing indexes</li>
                    <li value="8">Changing an index from <code>unique</code> to <code>nonunique</code> (allowing duplicates) and vice versa, </li>
                </ul>
                <blockquote>
                    <p>
                        <img src="../../../Resources/Images/note.png" />Note that changing an index to unique will fail if duplicate values are present with <code><a href="../../../Programming/C/Core_Functions/Static/Database_Control/load.htm">mco_db_load()</a></code> returning <code>MCO_S_DUPLICATE</code>. The application should not proceed to <code><a href="../../../Programming/C/Core_Functions/Static/Database_Control/connect.htm">mco_db_connect()</a></code> in such a case as this may result in a fatal error. The recommended practice for changing an index from <code>nonunique</code> to <code>unique</code> is to first traverse the index, detecting (by comparing the current key value with the previous key value) and removing all duplicates before changing the schema and performing schema evolution. </p>
                    <p>If a new field is being added to a <code>unique</code> index and the intention is to add both the field and the <code>unique</code> index with it, this should be done in two steps:</p>
                    <blockquote>
                        <p> 1) first add the field to the schema and assign unique values to it, </p>
                        <p>2) then add the unique index to the schema and perform schema evolution on this second pass.</p>
                    </blockquote>
                    <p>The case of adding a new field to an existing <code>unique</code> index should not cause <code><a href="../../../Programming/C/Core_Functions/Static/Database_Control/load.htm">mco_db_load()</a></code> to return <code>MCO_S_DUPLICATE</code> as it would not introduce new duplicates.</p>
                </blockquote>
                <p>&#160;</p>
                <p>A class <i>cannot</i><a name="kanchor1"></a> be renamed.  The runtime will treat the old class as having been dropped , and the new class as new.</p>
                <h2>BSE with <i>e</i>X<i>treme</i>DB<i> High Availability</i> <![CDATA[ ]]></h2>
                <p> The <i>e</i>X<i>treme</i>DB<i> High Availability</i> runtime automatically converts objects from the master schema to the replica's schema. And the <i style="font-weight: normal;">e</i>X<i style="font-weight: normal;">treme</i>DB <i style="font-weight: normal;">Cluster</i> runtime allows a single cluster to have different database schemas. </p>
                <p>Please view the <a href="../../HA/HA_Synchronization.htm">HA Synchronization</a> and the <a href="../../Cluster/CL_Implementation_Details.htm">Cluster Implementation Details</a> pages for further details.</p>
                <h2>BSE&#160;for Persistent Databases</h2>
                <p>Binary schema evolution  is automatically applied when the database dictionary is loaded during the database <code>open</code> procedure <i>for persistent databases</i> (or when a database image file is specified). The <i>e</i>X<i>treme</i>DB runtime automatically converts data fields present in the dictionary of the saved image to the type defined in the currently opened database dictionary and sets data fields not present in the saved image to default values. </p>
                <p>However note that:</p>
                <ul>
                    <li value="1">When adding a new class at the end of the schema file <i>e</i>X<i>treme</i>DB is able to perform a limited kind of schema evolution "on the fly" during <code><a href="../../../Programming/C/Core_Functions/Static/Database_Control/connect.htm">mco_db_connect()</a></code> automatically; this does not emit error code <code>MCO_E_DISK_SCHEMA_CHANGED</code> and there is no need to call the <code><a href="../../../Programming/C/Core_Functions/Static/Database_Control/save.htm">mco_db_save()</a></code> / <code><a href="../../../Programming/C/Core_Functions/Static/Database_Control/load.htm">mco_db_load()</a><![CDATA[  ]]></code>sequence for BSE to be applied.</li>
                    <li value="2">Inserting a new class in the middle of the static schema file should be done with caution. Normally it will trigger error code <code>MCO_E_DISK_SCHEMA_CHANGED</code> on the attempt to connect without performing BSE. However, in the very specific case when the new class definition replaces another class definition with exactly the same structure (but a different name) <i>e</i>X<i>treme</i>DB won't treat it as a new class definition and instead will assume that the old class was renamed. Hence <code>MCO_E_DISK_SCHEMA_CHANGED</code> will not be emitted and references to the new class will expose confusing behavior. It is recommended to avoid this situation.</li>
                </ul>
                <h3>Example</h3>
                <p>The SDK sample <a href="../../../Programming/C/SDK_Samples/Core_Samples/18-Backup_Migrate.htm">18-backup/Migrate</a> demonstrates how to migrate an existing persistent database to a different schema. </p>
            </blockquote>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="copyright" style="font-size: 8pt;"><a href="../../../Copyright_Notice.htm" title="Copyright Notice" alt="Copyright Notice">© 2001-2019 McObject LLC. All rights reserved</a>.</p>
            <p class="copyright" style="font-size: 8pt;">&#160;</p>
            <p class="copyrightFeedback" style="font-size: 8pt;"><a href="mailto:Support@McObject.com?subject=Online Documentation feedback">Send feedback</a> <span style="color: #000000;">on this topic to McObject. </span></p>
        </div>
    </body>
    <script id="MCO-LINKS">/* <![CDATA[ */
		(function(){
		var isFramed = false;
		try {
		isFramed = window != window.top || document != top.document || self.location != top.location;
		} catch (e) {
		isFramed = true;
		}
		if (!isFramed) {
		var link1 = document.createElement('a');
		link1.setAttribute('href','#');
		link1.setAttribute('id','back-id');
		link1.setAttribute('title','Go back');
		link1.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M0 0h24v24H0z" fill="none" /><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" /></svg>';
		var link2 = document.createElement('a');
		link2.setAttribute('href','/');
		link2.setAttribute('title','Go to mcobject.com');
		link2.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" /><path d="M0 0h24v24H0z" fill="none" /></svg>';
		var link3 = document.createElement('a');
		link3.setAttribute('href','/docs/extremedb.htm');
		link3.setAttribute('title','Go to table of content');
		link3.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z" /><path d="M0 0h24v24H0z" fill="none" /></svg>';
		var el = document.createElement('div');
		el.style.cssText = 'position:fixed;display:flex;flex-direction:column;right:16px;top:8px;background:#f7f7f7;box-shadow:4px 4px 4px #777777;padding:4px 8px;';
		el.appendChild(link1);
		el.appendChild(link2);
		el.appendChild(link3);
		document.body.append(el);
		document.querySelector('#back-id').addEventListener('click',function(e){e.preventDefault(); window.history.back();});
		}
		})();
	/* ]]> */</script>
</html>