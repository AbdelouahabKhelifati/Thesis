<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="extremedb.xml" data-mc-path-to-help-system="../../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Analytics Functions Example 11: Hash Aggregate</title>
        <link href="../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../Resources/Stylesheets/KB_Style.css" rel="stylesheet" />
        <script src="../../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="TopicContent">
            <div class="nocontent">
                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="7" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">ToC path: </span>
                </div>
            </div>
            <h1>Analytics Functions Example 11: Hash Aggregate</h1>
            <blockquote>
                <h2>Hash Aggregate Average</h2>
                <p>Compute the average <code>close</code> value for groups of trades having <code>volume</code> values grouped by millions of trades per day (for the first two weeks of March 2013):</p>
                <div class="code-block"><pre>    &#160;
    SELECT symbol, 
        seq_search(day, 20130304, 20130315) as Mar_2013,
        volume@Mar_2013 as "volume", close@Mar_2013 as "close",
        seq_hash_agg_avg(close@Mar_2013, volume@Mar_2013/1000000) as avg_vol,
        seq_hash_group_by(avg_vol) as "group_by"
    FROM Quote WHERE symbol='IBM';
    &#160;
    symbol
    Mar_2013{}
    volume{}
    close{}
    avg_vol{}
    group_by{}
    ------------------------------------------------------------------------------
    IBM
    {20130304, 20130305, 20130306, 20130307, 20130308,
    20130311, 20130312, 20130313, 20130314, 20130315}
    {3693365, 3807706, 3594899, 3884317, 3700786,
    3049701, 3592096, 3356946, 5505584, 7936544}
    {205.190002, 206.529999, 208.380005, 209.419998, 210.380005,
    210.080002, 210.550003, 212.059998, 215.800003, 214.919998}
    {214.919998, 209.073751, 215.800003}
    {7, 3, 5}
    &#160;</pre>
                </div>
                <p>Note that the "hash_aggregate" functions calculate aggregate values for each group  determined by an arbitrary sequence (not necessarily sorted, such as <code>close</code> above) using a hash table. So to interpret the result sets from these functions a “group_by” sequence is required. The function <code>seq_hash_group_by</code> returns the sequence of values used for grouping in order to make the correspondence between the values in the result sequence(s) and the groups.</p>
                <p>In the example above, the <code>close</code> prices are divided into groups associated with <code>volume</code> values where the <code>volume</code> is in ranges of <code>(0-999,999)</code>, <code>(1,000,000-1,999,999)</code>, <code>(2,000,000-2,999,999)</code>, etc. To illustrate we analyze the output as follows:</p>
                <ul>
                    <li value="1">	We have highlighted values in the output corresponding to the second element of the <code>group_by</code> sequence with value 3 (the last sequence in the output).</li>
                    <li value="2">	The corresponding value in the result sequence <code>avg_vol</code> is (<span style="background-color: #ffff00;">209.073751</span>).</li>
                    <li value="3">	To see how this is computed, we have highlighted the elements in the <code>volume</code> sequence having trading <code>volume</code> between 3M and 4M (<code>volume/1000000 = 3</code>). These values have position indexes of <code>(0,1,2,3,4,5,6)</code>.</li>
                    <li value="4">	The <code>close</code> values for elements 0 through 6 are averaged as follows:</li>
                </ul>
                <p><code style="background-color: #9acd32;">(205.190002 + 206.529999 + 208.380005 + 209.419998 + 210.380005 + 210.080002 + 210.550003 + 212.059998)</code><code> / 8 = </code><code style="background-color: #ffff00;">209.073751</code>
                </p>
                <p>Note also that the single occurrence of <code>volume</code> in the 5M range corresponds to the single <code>avg_vol</code> value <code>215.800003</code>, and the single occurrence of <code>volume</code> in the 7M range corresponds to the single <code>avg_vol</code> value <code>214.919998</code>.</p>
                <h2>To run this example</h2>
                <p>A sample script to demonstrate this <code>select</code> statement using <span style="color: #000000; font-style: italic; font-weight: normal;">xSQL</span> can be run from the <code>samples/xsql/scripts/financial</code> directory with the following command:</p>
                <div class="code-block"><pre>    &#160;
    x 11
    &#160;</pre>
                </div>
            </blockquote>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="copyright" style="font-size: 8pt;"><a href="../../../../Copyright_Notice.htm" title="Copyright Notice" alt="Copyright Notice">© 2001-2019 McObject LLC. All rights reserved</a>.</p>
            <p class="copyright" style="font-size: 8pt;">&#160;</p>
            <p class="copyrightFeedback" style="font-size: 8pt;"><a href="mailto:Support@McObject.com?subject=Online Documentation feedback">Send feedback</a> <span style="color: #000000;">on this topic to McObject. </span></p>
        </div>
    </body>
    <script id="MCO-LINKS">/* <![CDATA[ */
		(function(){
		var isFramed = false;
		try {
		isFramed = window != window.top || document != top.document || self.location != top.location;
		} catch (e) {
		isFramed = true;
		}
		if (!isFramed) {
		var link1 = document.createElement('a');
		link1.setAttribute('href','#');
		link1.setAttribute('id','back-id');
		link1.setAttribute('title','Go back');
		link1.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M0 0h24v24H0z" fill="none" /><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" /></svg>';
		var link2 = document.createElement('a');
		link2.setAttribute('href','/');
		link2.setAttribute('title','Go to mcobject.com');
		link2.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" /><path d="M0 0h24v24H0z" fill="none" /></svg>';
		var link3 = document.createElement('a');
		link3.setAttribute('href','/docs/extremedb.htm');
		link3.setAttribute('title','Go to table of content');
		link3.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z" /><path d="M0 0h24v24H0z" fill="none" /></svg>';
		var el = document.createElement('div');
		el.style.cssText = 'position:fixed;display:flex;flex-direction:column;right:16px;top:8px;background:#f7f7f7;box-shadow:4px 4px 4px #777777;padding:4px 8px;';
		el.appendChild(link1);
		el.appendChild(link2);
		el.appendChild(link3);
		document.body.append(el);
		document.querySelector('#back-id').addEventListener('click',function(e){e.preventDefault(); window.history.back();});
		}
		})();
	/* ]]> */</script>
</html>