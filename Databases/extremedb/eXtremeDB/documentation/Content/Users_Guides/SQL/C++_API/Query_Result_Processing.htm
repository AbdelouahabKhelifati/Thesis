<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="extremedb.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Programming with eXtremeDB|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]|[%=System.LinkedTitle%]">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>SQL Query Result Processing in C++</title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/KB_Style.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="TopicContent">
            <div class="nocontent">
                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="7" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">ToC path: </span>
                </div>
            </div>
            <h1>SQL Query Result Processing in C++</h1>
            <blockquote>
                <p>The <a href="../../../Programming/C++/Classes/QueryResult.htm"><i>QueryResult</i></a> class provides a convenient way to process SQL result set rows. The <code>records()</code> method returns a <i><a href="../../../Programming/C++/Classes/Cursor.htm">Cursor</a></i> object that provides method <code>hasNext()</code> to iterate over the result set rows and a number of methods for extracting the data or column information from these rows. For example the following code snippet demonstrates how to extract and print out the values from the result set of  query "select * from Person" (see <a href="../../../Getting_Started/Quick_Start/QS_Embedded_SQL/QS_Embedded_SQL_Cpp.htm">here</a> for the definition of database class <code>Person</code>):</p>
                <div class="code-block"><pre>&#160;
    void show_results(McoSqlEngine&amp; engine)
    {
        QueryResult result(engine.executeQuery("select * from Person"));
        Cursor * cursor = result-&gt;records();
        &#160;
        while (cursor-&gt;hasNext())
        { 
            Record * rec = cursor-&gt;next();
            &#160;
            // Extract the _Person record to the corresponding struct
            _Person p;
            result-&gt;extract(rec, &amp;p, sizeof(p));
            printf("\tName=%s, Ordinal=%u\n", p.name, p.ordinal );
        }
    }
    &#160;</pre>
                </div>
                <p>Note that the <code>struct</code> <code>_Person</code> is:</p>
                <div class="code-block"><pre>&#160;
    // Define the structure correponding to database table Person
    struct _Person
    {
        char const* name;
        uint4       ordinal;
    };
    &#160;</pre>
                </div>
                <h2>QueryResult usage</h2>
                <p>The main purpose of the C++ <i><a href="../../../Programming/C++/Classes/QueryResult.htm"><i>QueryResult</i></a></i> is to control the scope of the query and automatically release all allocated resources if the query is terminated abnormally. If the scope of the query (the lifetime of the <i><a href="../../../Programming/C++/Classes/QueryResult.htm"><i>QueryResult</i></a></i><a name="kanchor1020"></a> object instance) is incorrect it will lead to a runtime error. This can happen when the instance is used beyond the transaction it has been created in or still exists at the time the database instance is closed. The following code snippet demonstrates how this kind of <i>incorrect usage</i> may occur:</p>
                <div class="code-block"><pre>&#160;
    main (void)
    {
        McoSqlEngine engine;
        engine.open( ... );
        &#160;
        ...
&#160;
        QueryResult result(engine.executeQuery("select * from aRecord"));
        Cursor* cursor = result-&gt;records();
        while (cursor-&gt;hasNext()) {
            ...
        } /* end of while loop */
        engine.close(); /* database instance is destroyed here */
        return 0;
        &#160;
        /* object of class QueryResult represented by local variable 'result' will be deleted
        here. Since the database no longer exists, the QueryResult destructor crashes the
        application */
    }
    &#160;</pre>
                </div>
                <p>Because the transaction context that created the object is kept within the object, if the transaction is no longer valid, any operation over its handle leads to an error. In the code above, the <i><a href="../../../Programming/C++/Classes/QueryResult.htm"><i>QueryResult</i></a></i> destructor is called as the object <code>result</code> goes out of scope. But the transaction handle in result is no longer valid because the database has been closed. So the attempt to close the transaction causes the application to crash!</p>
                <p>To avoid this, any instance of the <i><a href="../../../Programming/C++/Classes/QueryResult.htm"><i>QueryResult</i></a></i> class must be deleted as soon as it is no longer required. This can be done by explicitly calling the <code>delete</code> operator on the object if it was created by <code>new</code>, or by using enclosing braces if the object is instantiated as a local variable.</p>
            </blockquote>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="copyright" style="font-size: 8pt;"><a href="../../../Copyright_Notice.htm" title="Copyright Notice" alt="Copyright Notice">Â© 2001-2019 McObject LLC. All rights reserved</a>.</p>
            <p class="copyright" style="font-size: 8pt;">&#160;</p>
            <p class="copyrightFeedback" style="font-size: 8pt;"><a href="mailto:Support@McObject.com?subject=Online Documentation feedback">Send feedback</a> <span style="color: #000000;">on this topic to McObject. </span></p>
        </div>
    </body>
    <script id="MCO-LINKS">/* <![CDATA[ */
		(function(){
		var isFramed = false;
		try {
		isFramed = window != window.top || document != top.document || self.location != top.location;
		} catch (e) {
		isFramed = true;
		}
		if (!isFramed) {
		var link1 = document.createElement('a');
		link1.setAttribute('href','#');
		link1.setAttribute('id','back-id');
		link1.setAttribute('title','Go back');
		link1.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M0 0h24v24H0z" fill="none" /><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" /></svg>';
		var link2 = document.createElement('a');
		link2.setAttribute('href','/');
		link2.setAttribute('title','Go to mcobject.com');
		link2.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" /><path d="M0 0h24v24H0z" fill="none" /></svg>';
		var link3 = document.createElement('a');
		link3.setAttribute('href','/docs/extremedb.htm');
		link3.setAttribute('title','Go to table of content');
		link3.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z" /><path d="M0 0h24v24H0z" fill="none" /></svg>';
		var el = document.createElement('div');
		el.style.cssText = 'position:fixed;display:flex;flex-direction:column;right:16px;top:8px;background:#f7f7f7;box-shadow:4px 4px 4px #777777;padding:4px 8px;';
		el.appendChild(link1);
		el.appendChild(link2);
		el.appendChild(link3);
		document.body.append(el);
		document.querySelector('#back-id').addEventListener('click',function(e){e.preventDefault(); window.history.back();});
		}
		})();
	/* ]]> */</script>
</html>