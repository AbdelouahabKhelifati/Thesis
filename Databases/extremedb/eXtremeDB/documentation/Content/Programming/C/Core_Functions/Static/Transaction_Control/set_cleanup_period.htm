<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" data-mc-search-type="Stem" data-mc-help-system-file-name="extremedb.xml" data-mc-path-to-help-system="../../../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Programming with eXtremeDB|Native APIs|[%=System.LinkedTitle%]|Static API|Transaction_Control">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>mco_trans_set_cleanup_period</title>
        <link href="../../../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../../../Resources/Stylesheets/KB_Style.css" rel="stylesheet" />
        <link href="../../../../../Resources/TableStyles/IndentedFunctionReference.css" rel="stylesheet" />
        <script src="../../../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="TopicContent">
            <div class="nocontent">
                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="7" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">ToC path: </span>
                </div>
            </div>
            <h1>mco_trans_set_cleanup_period</h1>
            <blockquote>
                <p>Control how often the <a href="../../../../../Users_Guides/Core/MVCC_Transaction_Manager.htm" name="kanchor506">MVCC Transaction Manager</a> removes unused versions.</p>
            </blockquote>
            <h3>Prototype</h3>
            <div class="code-block"><pre>&#160;
    int mco_trans_set_cleanup_period( /*IN*/ mco_db_h db,
                        /*IN*/ int cleanup_period, 
                        /*IN*/ mco_bool per_connection_cleanup);
&#160;</pre>
            </div>
            <h3>Arguments</h3>
            <table class="TableStyle-IndentedFunctionReference" style="mc-table-style: url('../../../../../Resources/TableStyles/IndentedFunctionReference.css');" cellspacing="0">
                <col class="TableStyle-IndentedFunctionReference-Column-Column1" style="width: 170px;" />
                <col class="TableStyle-IndentedFunctionReference-Column-Column2" style="width: 395px;" />
                <tbody>
                    <tr class="TableStyle-IndentedFunctionReference-Body-Body1">
                        <td class="TableStyle-IndentedFunctionReference-BodyE-Column1-Body1">db</td>
                        <td class="TableStyle-IndentedFunctionReference-BodyD-Column2-Body1">The database handle that was established by <code>mco_db_connect()</code></td>
                    </tr>
                    <tr class="TableStyle-IndentedFunctionReference-Body-Body1">
                        <td class="TableStyle-IndentedFunctionReference-BodyE-Column1-Body1">
                            <p>cleanup_period</p>
                        </td>
                        <td class="TableStyle-IndentedFunctionReference-BodyD-Column2-Body1">
                            <p>The number of commits to process before removing unused versions</p>
                        </td>
                    </tr>
                    <tr class="TableStyle-IndentedFunctionReference-Body-Body1">
                        <td class="TableStyle-IndentedFunctionReference-BodyB-Column1-Body1">
                            <p>per_connection_cleanup</p>
                        </td>
                        <td class="TableStyle-IndentedFunctionReference-BodyA-Column2-Body1">
                            <p>A boolean value: <code>MCO_YES</code> or <code>MCO_NO</code></p>
                        </td>
                    </tr>
                </tbody>
            </table>
            <h3>Description</h3>
            <blockquote>
                <p>This function controls how often (after what number of commits) the <a href="../../../../../Users_Guides/Core/MVCC_Transaction_Manager.htm">MVCC Transaction Manager</a> removes unused versions for this connection (if <code>per_connection_cleanup</code> is set to <code>MCO_YES</code>). The per connection clean-up can be suppressed by setting up the <code>cleanup_period</code> to zero. This is important for the applications that create many short write transactions and long <code>READ_ONLY</code> transactions. It makes sense to do the cleanup only in the <code>READ_ONLY</code> transactions (as the <code>READ_WRITE</code> transactions won’t be able to cleanup anything anyway - they would have to wait until a potentially long <code>READ_ONLY</code> transaction is committed). It is important to emphasize that if the unused versions are not removed a huge number of duplicate indexes could lead to performance degradation.</p>
                <p>When the task is disconnected from the database, or if <code>per_connection_cleanup</code> is set to <code>MCO_NO</code><a name="kanchor508"></a>, any left over unused versions created by the connections are placed into a “common pool” (common to all connections), which is processed by all connections. Thus, if task A does not normally touch the table T, it could still cause the removal of a version of T from the indexes, and therefore would need to apply locks to the runtime while accessing the index. We recommend implementing a task (connection) that works with the global pool and would be the last one to disconnect from the database. The default settings are to use the global pool. Using the local (per-connection) pool makes sense for applications that access a separate set of tables (classes) from different tasks (connections) and thus don’t create any locking conflicts.</p>
            </blockquote>
            <h3>Return Codes</h3>
            <table class="TableStyle-IndentedFunctionReference" style="mc-table-style: url('../../../../../Resources/TableStyles/IndentedFunctionReference.css');" cellspacing="0">
                <col class="TableStyle-IndentedFunctionReference-Column-Column1" />
                <col class="TableStyle-IndentedFunctionReference-Column-Column2" style="width: 142px;" />
                <tbody>
                    <tr class="TableStyle-IndentedFunctionReference-Body-Body1">
                        <td class="TableStyle-IndentedFunctionReference-BodyB-Column1-Body1">Integer</td>
                        <td class="TableStyle-IndentedFunctionReference-BodyA-Column2-Body1">Previous value of <code>cleanup_period</code></td>
                    </tr>
                </tbody>
            </table>
            <h3>Example</h3>
            <div class="code-block"><pre>&#160;
    Application snippet:
        
    &#160;
    const char * dbname = "SimpleDb";
    &#160;
    int main(int argc, char* argv[])
    {
        mco_db_h db;
        MCO_RET rc;
        mco_device_t       dev;
        mco_db_params_t    db_params;
        mco_trans_h t;
        int period = 1000;
        &#160;
        ...
        rc = mco_db_open_dev( dbname, simple_get_dictionary(), &amp;dev, 1, &amp;db_params );
        if ( MCO_S_OK != rc )
        {
            rc = mco_db_connect(  dbname, &amp;db );
            ...
            period = mco_trans_set_cleanup_period( db, period, MCO_NO );  
            printf("\nThe previous Cleanup Period was %d.", period );
        }
        ...
    }
    &#160;
&#160;</pre>
            </div>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="copyright" style="font-size: 8pt;"><a href="../../../../../Copyright_Notice.htm" title="Copyright Notice" alt="Copyright Notice">© 2001-2019 McObject LLC. All rights reserved</a>.</p>
            <p class="copyright" style="font-size: 8pt;">&#160;</p>
            <p class="copyrightFeedback" style="font-size: 8pt;"><a href="mailto:Support@McObject.com?subject=Online Documentation feedback">Send feedback</a> <span style="color: #000000;">on this topic to McObject. </span></p>
        </div>
    </body>
    <script id="MCO-LINKS">/* <![CDATA[ */
		(function(){
		var isFramed = false;
		try {
		isFramed = window != window.top || document != top.document || self.location != top.location;
		} catch (e) {
		isFramed = true;
		}
		if (!isFramed) {
		var link1 = document.createElement('a');
		link1.setAttribute('href','#');
		link1.setAttribute('id','back-id');
		link1.setAttribute('title','Go back');
		link1.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M0 0h24v24H0z" fill="none" /><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z" /></svg>';
		var link2 = document.createElement('a');
		link2.setAttribute('href','/');
		link2.setAttribute('title','Go to mcobject.com');
		link2.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" /><path d="M0 0h24v24H0z" fill="none" /></svg>';
		var link3 = document.createElement('a');
		link3.setAttribute('href','/docs/extremedb.htm');
		link3.setAttribute('title','Go to table of content');
		link3.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#555555"><path d="M3 9h14V7H3v2zm0 4h14v-2H3v2zm0 4h14v-2H3v2zm16 0h2v-2h-2v2zm0-10v2h2V7h-2zm0 6h2v-2h-2v2z" /><path d="M0 0h24v24H0z" fill="none" /></svg>';
		var el = document.createElement('div');
		el.style.cssText = 'position:fixed;display:flex;flex-direction:column;right:16px;top:8px;background:#f7f7f7;box-shadow:4px 4px 4px #777777;padding:4px 8px;';
		el.appendChild(link1);
		el.appendChild(link2);
		el.appendChild(link3);
		document.body.append(el);
		document.querySelector('#back-id').addEventListener('click',function(e){e.preventDefault(); window.history.back();});
		}
		})();
	/* ]]> */</script>
</html>